---
title: "Άσκηση1"
author: "Αγγελος Κοζωνακης"
date: "12/3/2021"
output:
  html_document: default
  pdf_document: default
---

**Εργαστηριακή άσκηση 1**

**Άσκηση πρώτη**
_Πρώτο Ερώτημα_

>Θα δούμε το διάστημα εμπιστοσύνης για διαφορά δύο μέσων τιμών σε μικρό δείγμα, οπότε θα χρησιμοποιήσουμε student στατιστικο (t.test).Για να κάνουμε το t.test όμως θα πρέπει να πληρούμε τις 3 προϋποθέσεις:
*Κανονικά κατανεμημένος πληθυσμός
*Διασπορές να είναι ίσες
*Ανεξάρτητα δείγματα (δίνετε απο εκφώνηση)

>Αρχικά Βάζω τις τιμές μου σε διανύσματα, και βρίσκω τις μέσες τιμές.

```{r}
cont<-c(47.6,53.4,49.5,47.8,51.2,46.7,52.5,51.2,50.4,48.7)
treat<-c(55.3,52.3,54.5,57.8,51.8,51.2,53.8,55.9,56.7,50.8)
mean(cont)
mean(treat)
```

>Εφόσον ξέρουμε οτι τα δείγματα ανεξάρτητα πάμε τωρα να εξετάσουμε την κανονικότητα για το κάθε ενα ξεχωριστά.

```{r}
par(mfrow=c(1,2))
qqnorm(cont, main="Normal Q-Q Plot for control")
qqline(cont)
qqnorm(treat, main="Normal Q-Q Plot for treatment")
qqline(treat)
par(mfrow=c(1,1))
```

>Βλέπουμε τα σημεία να βρίσκονται κοντά στη γραμμή άρα μπορούμε να δεχτόυμε οτι μάλλον προέρχονται απο κανονική κατανομή.Ένας άλλος τρόπος είναι η χρήση shapiro test για να είμαστε σίγουροι για την κανονικότητα.Σε αυή τη περίπτωση παίρνουμε μηδενική υπόθεση Ho ότι οι πληθυσμοί από τους οποίους προέρχονται τα δείγματα ακολουθούν κανονική κατανομή ενώ σαν Η1 ότι δεν ακολουθούν κανονική κατανομή.

```{r}
shapiro.test(cont)
shapiro.test(treat)
```

>Από τα αποτελέσματα βλέπουμε ότι τα p-values είναι >0,05 (0.66 στη μία περίπτωση και 0.84 αντίστοιχα) άρα δεν απορρίπτουμε την αρχική υπόθεση Η1 ότι οι πληθυσμοί από τους οποίους προέρχονται τα δείγματα ακολουθούν κανονική κατανομή. Θα δούμε στη συνέχεια εάν οι διασπορές είναι ίσες ή αν δεν είναι με ένα levene test, ώστε στη συνέχεια να κάνουμε το t.test μας.. Η0 πως οι διασπορές είναι ίσες και Η1 ότι διαφέρουν.

```{r}
library(car)

leveneTest(cont, treat, center="mean")
```

>Για κάποιο λόγο είχα θέμα στο να τρέξω το levene. Αν έτρεχε θα παίρναμε την τιμή F value που θα μας έδινε και θα βλέπαμε εάν F value > 0,05, στην οποία περίπτωση δεν θα απορρίπταμε την αρχική μας υπόθεση Η0 ότι οι διασπορές μας είναι ίσες. 
Αν F value < 0,05 τότε μάλλον η μηδενική μας υπόθεση απορρίπτεται και οι διαφορές μάλλον διαφέρουν. Αυτο μας νοιάζει ώστε το t.test να ξέρουν αν θα βάλουμε var.equal = TRUE/FALSE. Μηδενική μας υπόθεση Η0 είναι ότι μ1=μ2 δηλαδή οι πληθυσμιακές μας μέσες τιμές είναι ίσες ενώ, H1 ότι οι μέσες τιμές διαφέρουν και μπορούμε τωρα με το t.test να δούμε εαν αυτές οι τιμές είναι ίσες. Για να προχωρήσω θα βάλω έστω ότι οι διασπορές είναι ίσες άρα var.equal = T.

```{r}
t.test(cont,treat, mu=0,paired=F,var.equal=T,conf.level = 0.95)
```
>
*To mu=0 διότι υποθέσαμε μ1=μ2 άρα και μ1-μ2=0.
*Ανεξάρτητα, άρα paired=FALSE
*To default διάστημα εμπιστοσύνης της συνάρτησης αυτής ειναι το 95% αλλά το γράψαμε ώστε να φανεί (conf.level=0,95).
*Φαίνεται απο το αποτέλεσμα πώς το treatment είναι μεγαλύτερο από το control (54.01 > 49.90)


>Απο τα αποτελέσματα βλέπουμε πως p-value=0,0009333 < 0,05  και άρα η μηδενική μας υπόθεση Η0 ότι οι πληθυσμιακές μας μέσες τιμές είναι ίσες το πιο πιθανό είναι πως απορρίπτεται. Τα άλλα δεδομένα που παρατηρούμε είναι πως df = 18, και τιμή στατιστικού t=-3.9526 απο την οποία επίσης θα μπορούσαμε να ελέγξουμε αν θα απορρίψουμε ή όχι την αρχική μας υπόθεση. Θα έπρεπε δηλαδη να δούμε εάν η τιμή αυτή βρίσκεται στη περιοχή απόρριψης του διαστήματος εμπιστοσύνης μας.

_Δεύτερο Ερώτημα_

>Για να βρούμε τα διαστήματα εμπιστοσύνης αρκεί να εφαρμόσουμε το t.test και να διαβάσουμε τις τιμές που μας δίνει. Μιλάμε ακόμα για μέσες τιμές άρα απο το πρώτο μας t.test βλέπουμε πως το διάστημα εμπιστοσύνης 95%, είναι -6,294566<μ1-μ2<-1,925434.
Για την δεύτερη περίπτωση 99% Διάστημα εμπιστοσύνης αρκεί να αλλάξουμε το conf.level απο 0.95 σε 0.99 ενώ κρατάμε ίδιες τις άλλες παραμέτρους και να το ξανατρέξουμε.

```{r}
t.test(cont,treat, mu=0,paired=F,var.equal=T,conf.level = 0.99)
```

>Άρα το 99% Διαστημα εμπιστοσύνης είναι -7.10304<μ1-μ2<-1.11696.

**Άσκηση Δεύτερη**

>Για να αποδείξουμε ότι η δραστηριότητα του mEH με την naphthalene είναι μεγαλύτερη από αυτή με fluoranthene, θα δούμε αν ο μέσος όρος των παρατηρήσεων για την naphthalene είναι μεγαλύτερος απο αυτών για fluoranthene.
Θα ξεκινήσουμε με το να περάσουμε τα στοιχεία μας σε ενα data frame με την σειρά κιόλας με την οποία μας δίνονται εφόσον είναι και εξαρτημένα, και θα πούμε στην R να μπορεί να διαβάσει και τα ονόματα που δίνουμε με την συνάρτηση attach.

```{r}
dataf<-data.frame(compound=c("fluoranthene","fluoranthene","fluoranthene","fluoranthene","fluoranthene","naphthalene","naphthalene","naphthalene","naphthalene","naphthalene"),value=c(3.7,6.2,10.8,11.5,8.6,13.2,15.3,13.6,15.4,14.8)) 
attach(dataf) 
```

>Αφού κάναμε το attach τώρα με την συνάρτηση tapply θα βρούμε αντίστοιχα το μηκος,μέση τιμή, διασπορά και τυπική απόκλιση για τις δύο περιπτώσεις μας.

```{r}
tapply(value,compound,length)
tapply(value,compound,mean)
tapply(value,compound,var)
tapply(value,compound,sd)
tapply(value,compound,summary)
```

>Τώρα που έχω βρεί τις τιμές αυτές θα χωρίσω τα δεδομένα μου (value) με βάση τον σταθερό παράγοντα ο οποίος ειναι το compound.

```{r}
comp1<-value[compound=="fluoranthene"] 
comp2<-value[compound=="naphthalene"]
```

>Απο εδώ και πέρα υπάρχουν δύο τρόποι που μπορόυμε να αντιμετωπίσουμε το πρόβλημα.Ο πρώτος ειναι ακολουθώντας την διαδικασία όπως είναι τα δειγματα μας,δηλαδή εξαρτημένα ενώ ο άλλος βάση θεωρίας, είναι να δημιουργήσουμε ένα νέο, ανεξάρτητο τυχαίο δείγμα το οποίο θα είναι η διαφορά των τιμών του ενός σε αντιστοιχία προς του άλλου εφόσον προέρχεται απο πληθυσμό το δείγμα μας που εδώ πληρείτε η προϋπόθεση αυτή. Ακολουθήσαμε το δεύτερο τρόπο αλλα θα αναφέρουμε και πως θα γινόταν ο πρώτος. Στην περίπτωση μας θέλουμε να δουμε αν το comp2-comp1>0, και άρα το νέο μας διάνυσμα (εφόσον και οι τιμές μας ειναι σε αντιστοιχία) θα είναι:

```{r}
new<-comp2-comp1
```

>Απο εδώ και πέρα αρκεί να ελέγξουμε την κανονικότητα και θα το κάνουμε με την ίδια διαδικασία που χρησιμοποιήθηκε και στην πρώτη άσκηση.

```{r}
par(mfrow=c(1,2))
qqnorm(new,main="Normal Q-Q Plot for New")
qqline(new)
par(mfrow=c(1,1))
shapiro.test(new)
```
>Τα σημεία είναι αρκετά κοντά στην γραμμή μας, και βλέπουμε πως το p-value=0.4243>α άρα δεχόμαστε πως είναι πιθανό να έρχονται απο κανονική κατανομή.


>Τώρα το μόνο που πρέπει να κάνουμε είναι να προσαρμόσουμε σωστά το t.test μας, με μηδενική υπόθεση πως μcomp1=μcomp2, και Η1 εναλλακτικη ότι compμ1<μcomp2.

```{r}
t.test(comp2, comp1,mu=0,paired=T,conf.level=0.99,alternative="greater") 
```

>
*mu=0 λόγο μηδενικής υπόθεσης (μcomp1-μcomp2=0)
*Ανεξάρτητα άρα paired=T
*Θέλουμε Δ.Ε 99% άρα conf.level=0.99
*Επειδή ψάχνουμε αν ισχύει ότι μcomp2-μcomp1>0 τότε εφόσον έτσι έχουμε ορίσει το new διανυσμά μας, το alternative θέλουμε να είναι μεγαλύτερο, αν ήταν μcomp1-μcomp2 το διάνυσμά μας θα ήταν lower.

>Απο τα αποτελέσματα βλέπουμε πως το πιο πιθανό είναι η μηδενική μας υπόθεση να είναι λάθος, εφόσον το Δ.Ε ξεκινάει απο  1.2569 έως το συν άπειρο άρα και το 0 δεν εμπεριέχεται εκεί. Αυτό επίσης επιβεβαιώνεται απο το pvalue=0,004692<α=0,05. Άρα μπορόυμε να δεχτούμε πως η εναλλακτική (με 99% σιγουριά) ισχύει, δηλαδή μcomp2-μcomp1>0, που σημαίνει ότι η δραστηριότητα του mEH με την naphthalene είναι μεγαλύτερη από αυτή με fluoranthene.

_Σημείωση_

>Έχει σημασία η σειρά που βάζουμε εδώ το comp1, comp2 καθώς θα αλλάξει τα αποτελέσματά μας.Εφόσον ψάχνουμε naph/fluo δηλαδη comp2/comp1 τότε αν βάζαμε t.test(comp1,comp2,paired=T,var.equal=F,conf.level=0.99,alternative="greater")
θα μας έβγαζε ότι η μηδενική μας υπόθεση είναι σωστή καθώς στο Δ.Ε εμπεριέχεται η τιμή 0 της μηδενικής υπόθεσης.

_Άλλος τρόπος_

>Η παραπάνω διαδικασία θα έπρεπε να γίνει ξεχωριστά αν δεν τα μελετούσαμε ως νέο ανεξάρτητο δείγμα,όπως βλέπετε παρακάτω.

```{r}
par(mfrow=c(1,2))
qqnorm(comp1,main="Normal Q-Q Plot for fluoranthene")
qqline(comp1)
qqnorm(comp2,main="Normal Q-Q Plot for naphthalene")
qqline(comp2)
par(mfrow=c(1,1))
shapiro.test(comp1)
shapiro.test(comp2)
```

>Συνεχίζοντας απο εκεί που κάναμε τον ξεχωριστό έλεγχο, θα πρέπει να κάναμε ένα t.test για εξαρτημένα δείγματα όπως φαίνεται παρακάτω.

```{r}
t.test(comp2,comp1,paired=T,var.equal=F,conf.level=0.99,alternative="greater")
```

